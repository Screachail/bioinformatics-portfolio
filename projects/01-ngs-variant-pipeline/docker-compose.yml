version: '3.8'

services:
  ngs-pipeline:
    build:
      context: .
      dockerfile: Dockerfile
    container_name: ngs-variant-pipeline
    image: ngs-pipeline:latest
    volumes:
      # Mount the entire project directory
      - .:/workspace
      # Persist data directory
      - ./data:/workspace/data
      # Persist logs
      - ./logs:/workspace/logs
      # Mount scripts
      - ./scripts:/workspace/scripts
      # Mount tests
      - ./tests:/workspace/tests
      # Mount config
      - ./config:/workspace/config
    working_dir: /workspace
    environment:
      - PYTHONPATH=/workspace
      - PYTHONUNBUFFERED=1
    # Keep container running for interactive use
    stdin_open: true
    tty: true
    # Resource limits (adjust based on your system)
    deploy:
      resources:
        limits:
          cpus: '4'
          memory: 8G
        reservations:
          cpus: '2'
          memory: 4G
    # Optional: Add network for future services (Airflow, etc.)
    networks:
      - ngs-network

  # Future service: Airflow (placeholder for Month 3)
  # airflow:
  #   image: apache/airflow:2.8.0
  #   ...

networks:
  ngs-network:
    driver: bridge

volumes:
  data:
  logs:
